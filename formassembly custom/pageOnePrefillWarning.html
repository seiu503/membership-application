<!-- for page 1 of forms with prefill -->

<script type="text/javascript" src="https://van11y.net/downloads/modal/dist/van11y-accessible-modal-window-aria.min_1530368048.js"></script>

<script>

  // when page loads,
  document.addEventListener("DOMContentLoaded", function(){
  	console.log('domcontent loaded');

		// append hidden button to DOM
		var hiddenButton = document.createElement('button');
		hiddenButton.style.cssText = 'display:none;';
    hiddenButton.setAttribute("id", "hiddenButton");
		hiddenButton.setAttribute("data-modal-prefix-class", "simple-animated");
		hiddenButton.setAttribute("data-modal-content-id", "tfa_294");
		hiddenButton.setAttribute("data-modal-title", "Is this you?");
		hiddenButton.setAttribute("data-modal-close-text", "Yes, that's me. Take me to the form.");
		hiddenButton.setAttribute("data-modal-close-title", "Yes, that's me. Take me to the form.");
		document.body.appendChild(hiddenButton);
		console.log('appended hiddenButton');
		console.log(hiddenButton);

		// hide warning section
  	// document.getElementById('tfa_294').style.display = 'none';

  	// check if contact ID is prepopulated from query params
  	const urlParams = new URLSearchParams(window.location.search);
		const contactID = urlParams.get('tfa_281');
  	console.log(contactID);

  	// check if FA found a single SF contact
  	// and was able to populate the fullName field
  	const fullName = document.getElementById('tfa_284').value;
  	console.log(fullName);

  	// if contact ID and fullName both exist, simulate a click on the
  	// hidden button to trigger the modal opening
  	if (contactID && fullName) {
  		console.log('conditions met for hiddenButton click');
  		document.getElementById("hiddenButton").click();
  		// document.getElementById('tfa_294').style.display = 'block';
  	}

  	// save the form ID (from window.location.pathname) to a variable
  	// for generating the request URL
	 	const getFormIdFromPathname = (path) => {
  		return path.replace(/\D/g,'');
  	}

  	// save references to the form ID and title
  	// for submitting to the next form to generate the prefill link
  	const formID = getFormIdFromPathname(window.location.pathname);
  	console.log(formID);
  	const formTitle = document.getElementsByClassName("wFormTitle")[0].innerHTML;
  	console.log(formTitle);

  	// generate the link request URL
  	const requestURLWithQueryParams = 'https://seiu503.tfaforms.net/133?tfa_5=' + formID + '&tfa_6=' + encodeURIComponent(formTitle);
  	console.log(requestURLWithQueryParams);

  	// append link to linkInfo display div
  	const linkInfo = document.getElementById('tfa_292');
  	const linkHtml = '<a href=' + requestURLWithQueryParams + '>' + requestURLWithQueryParams + '</a>';
  	console.log(linkHtml);

  	linkInfo.innerHTML += linkHtml;


  });

</script>